// @generated by Cursor AI (Claude) — verified by Kevin

import { useTranslation } from 'react-i18next';
import { Bell, Check, X, Trash2, CheckCheck } from 'lucide-react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Separator } from '@/components/ui/separator';

/**
 * Composant NotificationCenter - Centre de notifications pour le dashboard citoyen
 * 
 * Affiche :
 * - Liste des notifications (changements de statut, etc.)
 * - Compteur de notifications non lues
 * - Actions : marquer comme lu, supprimer, tout marquer comme lu
 * 
 * @param {Object} props
 * @param {Array} props.notifications - Liste des notifications
 * @param {number} props.unreadCount - Nombre de notifications non lues
 * @param {Function} props.onMarkAsRead - Callback pour marquer une notification comme lue
 * @param {Function} props.onMarkAllAsRead - Callback pour marquer toutes comme lues
 * @param {Function} props.onRemove - Callback pour supprimer une notification
 * @param {Function} props.onClearAll - Callback pour supprimer toutes les notifications
 * 
 * @example
 * <NotificationCenter
 *   notifications={notifications}
 *   unreadCount={unreadCount}
 *   onMarkAsRead={markAsRead}
 *   onMarkAllAsRead={markAllAsRead}
 *   onRemove={removeNotification}
 *   onClearAll={clearAll}
 * />
 */
function NotificationCenter({
  notifications,
  unreadCount,
  onMarkAsRead,
  onMarkAllAsRead,
  onRemove,
  onClearAll,
}) {
  const { t } = useTranslation('common');

  /**
   * Formater la date relative (il y a X minutes/heures/jours)
   */
  const formatRelativeTime = (dateString) => {
    const date = new Date(dateString);
    const now = new Date();
    const diffMs = now - date;
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    const diffDays = Math.floor(diffMs / 86400000);

    if (diffMins < 1) {
      return t('notifications.time.justNow', { defaultValue: 'À l\'instant' });
    } else if (diffMins < 60) {
      return t('notifications.time.minutesAgo', { 
        defaultValue: 'Il y a {{count}} minute',
        defaultValue_plural: 'Il y a {{count}} minutes',
        count: diffMins 
      });
    } else if (diffHours < 24) {
      return t('notifications.time.hoursAgo', { 
        defaultValue: 'Il y a {{count}} heure',
        defaultValue_plural: 'Il y a {{count}} heures',
        count: diffHours 
      });
    } else if (diffDays < 7) {
      return t('notifications.time.daysAgo', { 
        defaultValue: 'Il y a {{count}} jour',
        defaultValue_plural: 'Il y a {{count}} jours',
        count: diffDays 
      });
    } else {
      return date.toLocaleDateString('fr-FR', {
        day: 'numeric',
        month: 'short',
        year: date.getFullYear() !== now.getFullYear() ? 'numeric' : undefined,
      });
    }
  };

  /**
   * Obtenir la couleur du badge selon le statut
   */
  const getStatusBadgeColor = (status) => {
    const colors = {
      pending: 'bg-yellow-100 text-yellow-800 border-yellow-200',
      in_progress: 'bg-blue-100 text-blue-800 border-blue-200',
      resolved: 'bg-green-100 text-green-800 border-green-200',
      rejected: 'bg-red-100 text-red-800 border-red-200',
    };
    return colors[status] || 'bg-neutral-100 text-neutral-800 border-neutral-200';
  };

  if (notifications.length === 0) {
    return (
      <Card>
        <CardContent className="p-8 text-center">
          <Bell className="w-12 h-12 mx-auto text-neutral-400 mb-4" />
          <p className="text-neutral-600">
            {t('notifications.empty', { 
              defaultValue: 'Aucune notification pour le moment' 
            })}
          </p>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card>
      <CardHeader>
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-3">
            <Bell className="w-5 h-5 text-primary-600" />
            <CardTitle>
              {t('notifications.title', { defaultValue: 'Notifications' })}
            </CardTitle>
            {unreadCount > 0 && (
              <Badge variant="destructive" className="ml-2">
                {unreadCount}
              </Badge>
            )}
          </div>
          <div className="flex items-center gap-2">
            {unreadCount > 0 && (
              <Button
                variant="ghost"
                size="sm"
                onClick={onMarkAllAsRead}
                className="text-sm"
              >
                <CheckCheck className="w-4 h-4 mr-1" />
                {t('notifications.markAllRead', { defaultValue: 'Tout marquer comme lu' })}
              </Button>
            )}
            {notifications.length > 0 && (
              <Button
                variant="ghost"
                size="sm"
                onClick={onClearAll}
                className="text-sm text-red-600 hover:text-red-700"
              >
                <Trash2 className="w-4 h-4 mr-1" />
                {t('notifications.clearAll', { defaultValue: 'Tout supprimer' })}
              </Button>
            )}
          </div>
        </div>
      </CardHeader>
      <CardContent className="p-0">
        <div className="divide-y divide-neutral-200">
          {notifications.map((notification) => (
            <div
              key={notification.id}
              className={`p-4 hover:bg-neutral-50 transition-colors ${
                !notification.read ? 'bg-primary-50/30' : ''
              }`}
            >
              <div className="flex items-start justify-between gap-3">
                <div className="flex-1 min-w-0">
                  <div className="flex items-center gap-2 mb-1">
                    <h4 className={`font-semibold text-sm ${
                      !notification.read ? 'text-primary-900' : 'text-neutral-900'
                    }`}>
                      {notification.title}
                    </h4>
                    {!notification.read && (
                      <div className="w-2 h-2 rounded-full bg-primary-600" />
                    )}
                  </div>
                  <p className="text-sm text-neutral-600 mb-2">
                    {notification.message}
                  </p>
                  <div className="flex items-center gap-3 flex-wrap">
                    <Badge 
                      variant="outline" 
                      className={`text-xs ${getStatusBadgeColor(notification.newStatus)}`}
                    >
                      {notification.statusLabel}
                    </Badge>
                    <span className="text-xs text-neutral-500">
                      {formatRelativeTime(notification.createdAt)}
                    </span>
                    {notification.commune && (
                      <span className="text-xs text-neutral-500">
                        • {notification.commune}
                      </span>
                    )}
                  </div>
                </div>
                <div className="flex items-center gap-1">
                  {!notification.read && (
                    <Button
                      variant="ghost"
                      size="sm"
                      onClick={() => onMarkAsRead(notification.id)}
                      className="h-8 w-8 p-0"
                      aria-label={t('notifications.markAsRead', { defaultValue: 'Marquer comme lu' })}
                    >
                      <Check className="w-4 h-4" />
                    </Button>
                  )}
                  <Button
                    variant="ghost"
                    size="sm"
                    onClick={() => onRemove(notification.id)}
                    className="h-8 w-8 p-0 text-neutral-400 hover:text-red-600"
                    aria-label={t('notifications.remove', { defaultValue: 'Supprimer' })}
                  >
                    <X className="w-4 h-4" />
                  </Button>
                </div>
              </div>
            </div>
          ))}
        </div>
      </CardContent>
    </Card>
  );
}

export default NotificationCenter;

